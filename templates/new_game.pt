<div metal:use-macro="layout">
    <div metal:fill-slot="content">
        
        <script type="text/javascript">
            $(function() {
                // lookup_agent();
                $("#opponent_name").focus();
                
                /*
                var delay = (function(){
                    var timer = 0;
                    return function(callback, ms){
                        clearTimeout (timer);
                        timer = setTimeout(callback, ms);
                    };
                })();
                
                $('#opponent_name').keyup(function() {
                    delay(lookup_user, 1000);
                });
                */
            });
            
            /*
            function lookup_user ()
            {
                var agent_name = $('#opponent_name').val();
                
                $('#ajax_target').load(
                    '${request.route_url('ajax/lookup_user')}',
                    {'username':agent_name},
                    function () {
                        if ($('#ajax_target').html() != "-1")
                        {
                            $('#select_player_row td').css('background-color','');
                            $('#player_name_info').html('&nbsp;');
                            // $('#main_submit').removeAttr('disabled');
                        }
                        else if (agent_name == "")
                        {
                            $('#select_player_row td').css('background-color','');
                            $('#player_name_info').html('&nbsp;');
                            // $('#main_submit').attr('disabled', 'disabled');
                        }
                        else
                        {
                            $('#select_player_row td').css('background-color','#A00');
                            $('#player_name_info').html('Cannot find agent by that name');
                            // $('#main_submit').attr('disabled', 'disabled');
                        }
                });
            }
            
            // Ensure we have a valid username before we submit anything
            function check_username ()
            {
                if ($('#ajax_target').html() == "-1")
                {
                    return false;
                }
                return true;    
            }
            */
        </script>
        
        <div tal:condition="message != ''" id="flash_update" style="border: 1px solid #AAA; margin:10px; padding:10px; text-align:center;">
            ${message}
            
            <script type="text/javascript" charset="utf-8">
                $(document).ready(function() {
                    $('#flash_update').show();
                    $('#flash_update').animate({backgroundColor: "#${flash_colour}"}, 500);
                    $('#flash_update').animate({backgroundColor: "#FFF"}, 1500);
                });
            </script>
        </div>
        
        <form action="${request.route_url('games/wordy/new_game')}" method="post" accept-charset="utf-8" onsubmit="return check_username();">
            <table border="0" cellspacing="0" cellpadding="5">
                <tr id="select_player_row">
                    <td>Select your opponent (use usernames, e.g. jordant)</td>
                    <td><input type="text" name="opponent_name" id="opponent_name" value="${opponent_name}" onchange="lookup_user();"/></td>
                    <td id="player_name_info"></td>
                </tr>
                <tr>
                    <td colspan="3">
                        <input type="submit" id="main_submit" name="form.submitted" class="button" value="Start game" />
                    </td>
                </tr>
            </table>
            
            
        </form>
        
    </div>
</div>